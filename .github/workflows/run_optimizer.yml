name: Run Warehouse Route Optimizer

on:
  schedule:
    - cron: '30 17 * * *'  # Runs every day at 11:00 PM IST (17:30 UTC)
  workflow_dispatch:

jobs:
  run-optimizer:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy requests google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client ortools

    - name: Decode and create service account key file
      shell: bash
      run: |
        echo "${{ secrets.WAREHOUSE_GDRIVE_KEY }}" | base64 -d > service_account.json
        echo "âœ… service_account.json created."
        head -c 80 service_account.json || true  # sanity check preview

    - name: Run Warehouse Route Optimizer
      run: |
        python warehouse_route_optimizer.py

    - name: Verify JSON output
      run: |
        echo "ğŸ“„ Checking JSON output..."
        cat warehouse_route_summary.json || echo "âš ï¸ No output file found!"
